# سریالیزیشن (Serialization) و هش کردن

سریالیزیشن (Serialization) و هش کردن دو مفهوم بسیار مهم در فناوری بلاکچین هستند. آنها بنیادی هستند که یکپارچگی و سازگاری دفتر کل توزیع‌شده بر آن بنا شده است.

-   **سریالیزیشن (Serialization)** فرآیند تبدیل یک ساختار داده، مانند یک بلاک یا یک تراکنش، به فرمتی است که به راحتی قابل ذخیره یا انتقال باشد. در بلاکچین، بسیار مهم است که همه شرکت‌کنندگان در شبکه، داده‌ها را دقیقاً به یک روش سریالیزیشن کنند تا اطمینان حاصل شود که همه آنها هش یکسانی را دریافت می‌کنند. در این پروژه، ما از JSON به عنوان فرمت سریالیزیشن خود استفاده خواهیم کرد.
-   **هش کردن** فرآیند دریافت ورودی با هر اندازه‌ای و تولید خروجی با اندازه ثابت است که به عنوان هش شناخته می‌شود. این فرآیند یک‌طرفه است، به این معنی که معکوس کردن آن از نظر محاسباتی غیرممکن است. در بلاکچین، هش کردن برای ایجاد شناسه‌های منحصر به فرد برای بلاک‌ها و تراکنش‌ها و برای اطمینان از یکپارچگی داده‌ها استفاده می‌شود.

## سریالیزیشن (Serialization)

برای اطمینان از اینکه همه گره‌ها در شبکه می‌توانند در مورد وضعیت بلاکچین به توافق برسند، باید مجموعه‌ای دقیق از قوانین برای نحوه سریالیزیشن داده‌ها وجود داشته باشد. در این پروژه، ما ساختارهای داده خود را به یک رشته JSON سریالیزیشن خواهیم کرد. برای اطمینان از اینکه رشته JSON همیشه یکسان است، ما از قوانین زیر پیروی خواهیم کرد:

-   **ترتیب فیلدها:** فیلدهای یک ساختار داده باید دقیقاً به ترتیبی که مستند شده‌اند، سریالیزیشن شوند.
-   **بدون فضای خالی اضافی:** رشته JSON نباید حاوی هیچ فضای خالی اضافی باشد.

به عنوان مثال، یک شی ساده مانند `{ "b": 1, "a": 2 }` اگر ترتیب مستند شده `a` و سپس `b` باشد، باید به صورت `{"a":2,"b":1}` سریالیزیشن شود.

### پیش‌تصویر امضای تراکنش

هنگام ایجاد یک امضای دیجیتال برای یک تراکنش، ما کل داده‌های تراکنش را امضا نمی‌کنیم. در عوض، ما زیرمجموعه خاصی از داده‌ها را که **پیش‌تصویر تراکنش** نامیده می‌شود، امضا می‌کنیم. این برای جلوگیری از وابستگی دایره‌ای است که در آن امضا باید بخشی از داده‌های در حال امضا باشد.

پیش‌تصویر فقط شامل مراجع ورودی (`prevTxId` و `prevOutIndex`) و خروجی‌ها (`value` و `publicKey`) است. فیلدهای امضا در ورودی‌ها خالی گذاشته می‌شوند. سپس پیش‌تصویر قبل از امضا شدن به یک رشته JSON سریالیزیشن می‌شود.

## هش کردن

هنگامی که یک ساختار داده به یک رشته JSON سریالیزیشن شد، می‌توان آن را هش کرد تا یک شناسه منحصر به فرد و با اندازه ثابت تولید شود.

### شناسه تراکنش (txid)

`txid` شناسه منحصر به فرد برای یک تراکنش است. این با هش کردن کل رشته JSON تراکنش سریالیزیشن شده، از جمله امضاهای دیجیتال، محاسبه می‌شود.

`txid = Hash(serialize(full transaction))`

### هش بلاک

`blockHash` شناسه منحصر به فرد برای یک بلاک است. این با هش کردن رشته JSON هدر بلاک سریالیزیشن شده محاسبه می‌شود.

`blockHash = Hash(serialize(header))`

هدر بلاک شامل فیلدهای زیر است (برای بلاک جنسیس، `prevBlockHash` یک رشته از 64 صفر است):

-   `prevBlockHash`
-   `merkleRoot`
-   `difficulty`
-   `nonce`

برای تمام عملیات هش کردن در این پروژه، شما باید به طور مداوم از یک تابع هش واحد، مانند SHA-256، استفاده کنید.

## چرا این مهم است

قوانین دقیق برای سریالیزیشن و هش کردن چیزی است که بلاکچین را امن و تغییرناپذیر می‌کند. هر تغییر کوچکی در داده‌های یک بلاک یا تراکنش منجر به هش کاملاً متفاوتی می‌شود. این امر تشخیص هرگونه دستکاری در داده‌ها را آسان می‌کند و یک بلوک ساختمانی اساسی برای ویژگی‌هایی مانند اثبات مرکل است.

---
[← بازگشت: امضاهای دیجیتال و پیش‌تصویر تراکنش](signatures-preimage.md) · [بعدی: واژه‌نامه →](glossary.md)