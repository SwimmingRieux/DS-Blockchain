# قوانین اعتبارسنجی

## اعتبارسنجی تراکنش (غیر-کوین‌بیس)
- برای هر ورودی
  - UTXO ارجاع شده `(prevTxId, prevOutIndex)` وجود داشته باشد و خرج نشده باشد.
  - UTXO.publicKey برابر با input.publicKey باشد.
  - امضا بر روی preimage تأیید شود.
- مجموع (ورودی‌ها) ≥ مجموع (خروجی‌ها)
- کارمزد = مجموع (ورودی‌ها) − مجموع (خروجی‌ها) ≥ 0
- هیچ ورودی دو بار به یک UTXO در یک تراکنش ارجاع ندهد.

## تراکنش کوین‌بیس
- دقیقاً یک ورودی ساختگی (dummy input)
- ارزش خروجی‌ها = `یارانه + مجموع (کارمزدهای تراکنش‌های شامل شده)`

## اعتبارسنجی بلاک
- اولین تراکنش کوین‌بیس باشد؛ بقیه نباشند.
- عدم خرج مضاعف درون بلاکی
- ریشه مرکل با `txid` تراکنش‌ها مطابقت داشته باشد.
- اثبات کار (Proof of Work) با `difficulty.leadingZeroBits` مطابقت داشته باشد.
- محدودیت اندازه بلاک: مجموع بایت‌های سریالی شده هدر + تراکنش‌ها ≤ 2000 بایت
- `prevBlockHash` هدر برابر با هش هدر بلاک قبلی باشد. برای بلاک جنسیس، این باید یک رشته ۶۴ صفر باشد.

## پذیرش در ممپول (Mempool)
- تمام قوانین تراکنش اعمال می‌شوند؛ والدین ممکن است تأیید نشده باشند اما باید در ممپول موجود (یا ارجاع شده) باشند.
- لبه‌های DAG را به والدین حفظ کند؛ در صورت ایجاد چرخه رد شود.

## preimage امضا (آنچه امضا و تأیید می‌کنید)
```
preimage = serialize({
  inputs:  [{ prevTxId, prevOutIndex }],
  outputs: [{ value, publicKey }]
})
```
- تمام ورودی‌ها یک preimage یکسان را امضا می‌کنند (مشابه SIGHASH_ALL)
- تأیید از `publicKey` ورودی استفاده می‌کند.

## نکته برای مبتدیان: کارمزدها و کوین‌بیس
- کاربران با تنظیم `مجموع (خروجی‌ها) < مجموع (ورودی‌ها)` کارمزد تعیین می‌کنند؛ تفاوت، کارمزد است.
- ماینرها تمام کارمزدهای موجود در خروجی کوین‌بیس بلاک را جمع‌آوری می‌کنند.

---
[← بازگشت: واژه‌نامه](../concepts/glossary.md) · [بعدی: دستورات CLI →](cli.md)